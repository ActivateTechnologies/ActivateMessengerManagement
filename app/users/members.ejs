<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="img/activateFavicon.png">

    <title>Activate | <%=s.company.name%></title>

		<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
		<link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/dashboardCoded.css" rel="stylesheet">
	</head>

	<body ng-app="sortTable" ng-controller="usersCtrl">
		<nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a href="dashboard.<%=s.company.code%>"><img class="activateLogoHeader" src="img/ActivateLogoWhite.png"></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="dashboard.<%=s.company.code%>">Overview</a></li>
            <li><a href="events.<%=s.company.code%>">Events</a></li>
            <li><a href="message.<%=s.company.code%>">Message</a></li>
            <li><a href="users.<%=s.company.code%>">Members</a></li>
          </ul>
        </div>
      </div>
    </nav>


		<div class="container">
			<h1>Users</h1>
			<!-- <input ng-model="filterBy"> -->
			<ul>
				<li ng-repeat="user in selectedItems">{{user.firstName + " " + user.lastName}}</li>
			</ul>
			<div class="table-responsive">
	            <table class="table table-striped">
	              <thead>
	                <tr>
	                  <th></th>
	                  <th>FB Profile Pic</th>
	                  <th ng-click="headingClicked(0)"><span class="glyphicon glyphicon-sort-by-attributes" ng-if="currentHead==0 && isReversed==false"> </span><span class="glyphicon glyphicon-sort-by-attributes-alt" ng-if="currentHead==0 && isReversed==true"> </span>Name</th>
	                  <th ng-click="headingClicked(1)"><span class="glyphicon glyphicon-sort-by-attributes" ng-if="currentHead==1 && isReversed==false"> </span><span class="glyphicon glyphicon-sort-by-attributes-alt" ng-if="currentHead==1 && isReversed==true"> </span>Gender</th>
	                  <th ng-click="headingClicked(2)" ng-if="isDisplayed(2)"><span class="glyphicon glyphicon-sort-by-attributes" ng-if="currentHead==2 && isReversed==false"> </span><span class="glyphicon glyphicon-sort-by-attributes-alt" ng-if="currentHead==2 && isReversed==true"> </span>Phone Number</th>
                    <th ng-if="isDisplayed(3)">Email</th>
                    <th ng-if="isDisplayed(4)">Preferred Position</th>
                    <th ng-if="isDisplayed(5)">Backup Position</th>
                    <th ng-if="isDisplayed(6)">Level</th>
                    <th ng-if="isDisplayed(7)">New/Returning</th>
                    <th>Signed Up Date</th>
                    <th>Messenger ID</th>
<!-- 	                  <th ng-click="headingClicked(3)"><span class="glyphicon glyphicon-sort-by-attributes" ng-if="currentHead==3 && isReversed==false"> </span><span class="glyphicon glyphicon-sort-by-attributes-alt" ng-if="currentHead==3 && isReversed==true"> </span>No Of Events Attended</th> -->
	                  <th>Select</th>
	                </tr>
	              </thead>
	              <tbody id="usersTBody">
	              	<tr ng-repeat="user in users | orderBy:orderField:isReversed | filter:filterBy">
	              		<td>{{$index + 1}}</td>
	              		<td><img style="height:50px;" src="{{user.profilePic}}" /></td>
	              		<td>{{user.firstName + " " + user.lastName}}</td>
	              		<td>{{user.gender}}</td>
	              		<td>{{user.extras[0].phoneNumber}}</td>
                    <td>{{user.extras[1].email}}</td>
                    <td>{{user.extras[2].preferredPosition}}</td>
                    <td>{{user.extras[3].backup}}</td>
                    <td>{{user.extras[4].level}}</td>
                    <td>{{user.extras[5].type}}</td>
	              		<td>{{user.signedUpDate}}</td>
                    <td>{{user.mid}}</td>
	              		<td><input type="checkbox" ng-model="selection" ng-change="updateSelectedItems(user._id)"></td>
	              	</tr>
	              </tbody>
	            </table>
        	</div>
		</div>

    <script type="text/javascript">
    var app = angular.module('sortTable' , []);

    app.controller('usersCtrl', ['$scope', '$http' , function($scope, $http) {
      $http.get('/userAnalyticsData.<%= s.company.code %>').success(function(response) {
        $scope.users = response.users;
        var hashtable = {
          "phoneNumber": 1,
          "email":2
        }
        hashtable[user.extras]
      })

      $scope.currentHead = -1;

      $scope.isDisplayed = function(head) {
        for(i = 0; i < $scope.users.length; i++) {
          switch(head) {
            case 2:
              if(user[i].phoneNumber != null) {
                return true;
              }
              break;
            case 3:
              if(user[i].email != null) {
                return true;
              }
              break;
            case 4:
              if(user[i].preferredPosition != null) {
                return true;
              }
              break;
            case 5:
              if(user[i].backup != null) {
                return true;
              }
              break;
            case 6:
              if(user[i].level != null) {
                return true;
              }
              break;
            case 7:
              if(user[i].type != null) {
                return true;
              }
              break;
          }
        }
        return false;
      }

      $scope.headingClicked = function(head) {
        if($scope.currentHead == head) {
          $scope.isReversed = !$scope.isReversed;
        } else {
          $scope.isReversed = false;
        }

        $scope.currentHead = head;

        switch(head) {
          case 0:
            $scope.orderField = ['firstName','lastName'];
            break;
          case 1:
            $scope.orderField = 'gender';
            break;
          case 2:
            $scope.orderField = 'phoneNumber';
            break
          case 3:
            $scope.orderField = 'events.length';
            break;
        }
      }

      $scope.selectedItems = [];

      $scope.updateSelectedItems = function(id) {
        console.log(id);
        var index = JSON.stringify($scope.selectedItems).indexOf(id);
        if(index < 0) {
          $scope.users.forEach(function(user) {
            if (user._id == id) {
              $scope.selectedItems.push(user);
            }
          });
        } else {
          for(i = 0; i < $scope.selectedItems.length; i++) {
            if($scope.selectedItems[i]._id == id) {
              $scope.selectedItems.splice(i, 1);
              console.log("BYE");
            }
          }
        }
        console.log($scope.selectedItems);
      }
    }])

    </script>
	</body>
</html>
