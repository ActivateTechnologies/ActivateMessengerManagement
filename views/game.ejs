<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>The Game</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css">
    <link rel="stylesheet" href="css/input.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>
  </head>
  <body>
    <div class="container">
      <h2 id="text">Check out our bot to book the game.</h2>
      <button id="lg" class="btn" onclick="magic()">Log In</button>
      <div class="row">
        <div class="col l4">
          <p></p>
        </div>
        <div class="col l4">
          <div id="clicker">
            <div class="fb-send-to-messenger"
              messenger_app_id="159289771143437"
              page_id="245261069180348"
              data-ref="<%= gid %>"
              color="blue"
              size="xlarge">
            </div>
          </div>
        </div>
        <div class="col l4">
          <p></p>
        </div>
      </div>
    </div>

    <script>

    function magic(){
      console.log("called magic");
      FB.login(function(res) {
        if (res.authResponse) {
          location.reload()
        } else {
         console.log('User cancelled login or did not fully authorize.');
        }
      });
    }

      window.fbAsyncInit = function() {
        FB.init({
          appId: "159289771143437",
          xfbml: true,
          version: "v2.6"
        });

        FB.getLoginStatus(function(response) {
          if (response.status === 'connected') {
            var lg = document.getElementById('lg');
            lg.style.display = "none";
            console.log('Logged in.');
          }
          else {

          }
        });

      };

      (function(d, s, id){
         var js, fjs = d.getElementsByTagName(s)[0];
         if (d.getElementById(id)) { return; }
         js = d.createElement(s); js.id = id;
         js.src = "//connect.facebook.net/en_US/sdk.js";
         fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));

      var myConfObj = {
        iframeMouseOver : false
      }
      window.addEventListener('blur',function(){
        if(myConfObj.iframeMouseOver){
          window.location.href = "http://m.me/245261069180348";
        }
      });

      document.getElementById('clicker').addEventListener('mouseover',function(){
         myConfObj.iframeMouseOver = true;
      });
      document.getElementById('clicker').addEventListener('mouseout',function(){
          myConfObj.iframeMouseOver = false;
      });

    </script>
  </body>
</html>
