<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Kickabout | Pay</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css">
    <link href='https://fonts.googleapis.com/css?family=Muli' rel='stylesheet' type='text/css'>
    <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0;">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>
    <script type="text/javascript" src="https://js.stripe.com/v2/"></script>

    <style media="screen">
      #payment-form {
        max-width: 500px;
        display: block;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <img src="img/linear-logo.png" class="logoLead2">
    </div>
    <div class="container">
      <form action="/custompayment" method="POST" id="payment-form">
        <span class="payment-errors"></span>
        <div class="input-field">
          <input type="text" name="amount" placeholder="Amount (Â£)">
        </div>
        <div class="input-field">
          <input type="text" name="reference" placeholder="Reference">
        </div>
        <div class="input-field">
          <input type="text" data-stripe="number" placeholder="Card Number">
        </div>
        <div class="row">
          <div class="col s6">
            <div class="input-field">
              <input type="text" data-stripe="exp_month" placeholder="expiry month (MM)">
            </div>
          </div>
          <div class="col s6">
            <div class="input-field">
              <input type="text" data-stripe="exp_year" placeholder="expiry year (YY)">
            </div>
          </div>
        </div>

        <div class="input-field">
          <input type="text" data-stripe="cvc" placeholder="CVC">
        </div>

        <input type="submit" class="submit" value="Submit Payment">
      </form>
    </div>

    <script type="text/javascript">
      // Stripe.setPublishableKey('pk_test_p3GX2e0V1P9FteC3qz29z4YK');
      Stripe.setPublishableKey('pk_live_Dey0ulbB4AOL81fmpzWnFKYa');

      $(function() {
        var $form = $('#payment-form');
        $form.submit(function(event) {
          // Disable the submit button to prevent repeated clicks:
          $form.find('.submit').prop('disabled', true);

          // Request a token from Stripe:
          Stripe.card.createToken($form, stripeResponseHandler);

          // Prevent the form from being submitted:
          return false;
        });
      });

      function stripeResponseHandler(status, response) {
        // Grab the form:
        var $form = $('#payment-form');

        if (response.error) { // Problem!

          // Show the errors on the form:
          $form.find('.payment-errors').text(response.error.message);
          $form.find('.submit').prop('disabled', false); // Re-enable submission

        } else { // Token was created!

          // Get the token ID:
          var token = response.id;

          // Insert the token ID into the form so it gets submitted to the server:
          $form.append($('<input type="hidden" name="stripeToken">').val(token));

          // Submit the form:
          $form.get(0).submit();
        }
      };
    </script>
  </body>
</html>
